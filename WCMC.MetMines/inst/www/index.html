<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="">
  <link href="bootstrap.css" rel="stylesheet">
  <link href="sb-admin.css" rel="stylesheet">
  <link href="mETABOX.css" rel="stylesheet">
  <script type="text/javascript" src="jquery-2.2.3.min.js"></script>
  <script type="text/javascript" src="opencpu-0.5.js"></script>
  <script type="text/javascript" src="mETABOX.js"></script>
  <script type="text/javascript" src="bootstrap.js"></script>
  <script type="text/javascript" src="spin.js"></script>
  <script>
  </script>
  <title>ChemRICH </title>
  <script>

  var sessionid_m = "";  
  
  $(function(){

	$("#computeMetaMapp").click(function(){
		$('#net85').empty();
		$('#clust85').empty();
		$('#pre85').empty();
		$("#downloadPPT_Btn").empty();
		$("#downloadCPD_Btn").empty();
	
		var loadSpinner = showSpinner(txt='** Calculating ChemRICH enrichment, it can take up to 2 minutes, please be patient .....');
		var txtinput = $("#rawinput").val().trim();
		var req = ocpu.call("createPCA",{stat_file:txtinput}, function(session) {//calls R function:
			console.log(session);
			$("#downloadPPT_Btn").removeAttr('disabled');
			$("#downloadCPD_Btn").removeAttr('disabled');
			sessionid_m = session.loc;
			//$('#net85').prepend('<img src="'+session.loc+'files/pubsim_0.85.png'+'" class="img-thumbnail" alt="Responsive image">')
			$('#clust85').prepend('<img src="'+session.loc+'files/chemclust_0.85.png'+'" class="img-thumbnail" alt="Responsive image">')
			
			var ppturl = session.loc + 'files/wcmc_pca.pptx'
			$("#downloadPPT_Btn").append('<a href="'+ppturl+'">Download Powerpoint Slide</a>')
			
			var cpdurl = session.loc + 'files/cpd_enrichment_results_0.85.tsv'
			$("#downloadCPD_Btn").append('<a href="'+cpdurl+'">Download Compound Results</a>')
			
			
			$.ajax({
				type: "GET",
				url: session.loc + 'files/enrichment_results_0.85.tsv',
				success: function(response) {
					$("#pre85").html('<pre>'+response+'</pre>');
				}
			});
			
			hideSpinner(loadSpinner);				
		}).fail(function() {alert("Error: " + req.responseText)});//ocpu.call
	})
	
	
	})
  </script>
</head>

<body>

  <div >
    <!-- Navigation -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
	<a class="navbar-brand" >ChemRICH : Set Enrichment of Metabolomics/Lipidomics datasets using Chemical Similarity Networks</a>
	</nav>
      

    <div >
      <div class="container-fluid">
        <!-- Page Heading -->
        <div class="row">
          <div class="col-lg-12">


          </div>
        </div>
        <!-- /.row -->
        <!-- Main content -->

		<div class="row"> <!-- Generate Node Attribute files -->
          <div class="col-lg-12">
            <div class="panel panel-info">
              <div class="panel-heading">
                <h3 class="panel-title"><a data-toggle="collapse" data-target="#args" href="#">Generate chemical similarity network enrichment analysis.</a></h3>
              </div>
              <div id="args" class="panel-body collapse in">
                <form role="form">
                  <div class="form-group">
                    <label for="rawinput">Paste Statistical Results.  ( <a href="sample_stat_data.txt" target="_blank"> Example Data File </a> )   </label>
                    <textarea class="form-control" id="rawinput" name="txtinput" rows="5"></textarea>
                    <p class="help-block"> The input file should have four columms. Col1 = Lipid Name, Col2 = SMILES, Col3=FoldChange or effect, Col4 = pvalue.  Please use the example file as a templete. It is recommended to use median to calcualte the fold-changes, as median are not sensitive to outliers. For getting KEGG or PubChem IDs for metabolites names, use <a href="https://pubchem.ncbi.nlm.nih.gov/idexchange/idexchange.cgi" target="_blank"> PubChem Identifier Exchanger </a> tool.  For statistical analysis,  use <a href="http://metabox.fiehnlab.ucdavis.edu/ocpu/library/metabox/www/" target="_blank"> MetaBox </a> software. </p>
                  </div>
                  <!-- /.row -->
                  <button id="computeMetaMapp" type="button" class="btn btn-primary">Run</button>
				  <button id="downloadPPT_Btn" type="button" class="btn btn-default" disabled><i class="fa fa-download"></i> Editable PPTx </button>
				  <button id="downloadCPD_Btn" type="button" class="btn btn-default" disabled><i class="fa fa-download"></i> XLSx </button>
                </form>
              </div>
            </div>
          </div>
        </div>


	
		<div class="row"> <!-- Generate Node Attribute files -->
          <div class="col-lg-12">
            <div class="panel panel-success">
              <div class="panel-heading">
                <h3 class="panel-title"><a data-toggle="collapse" data-target="#args" href="#">Clustered Visualization of the Nodes.</a></h3>
              </div>
              <div id="clust85" class="panel-body collapse in">
					
              </div>
            </div>
          </div>
        </div>
		
		<div class="row"> <!-- Generate Node Attribute files -->
          <div class="col-lg-12">
            <div class="panel panel-success">
              <div class="panel-heading">
                <h3 class="panel-title"><a data-toggle="collapse" data-target="#args" href="#">Clusters of Lipids with Enrichment results</a></h3>
              </div>
              <div id="pre85" class="panel-body collapse in">
					
              </div>
            </div>
          </div>
        </div>
		



		<div class="row">
          <div class="col-lg-12">
            <div class="panel panel-primary">
              <div class="panel-heading">
                <h3 class="panel-title"><a data-toggle="collapse" data-target="#args" href="#">Instructions and citations</a></h3>
            </div>
              <div id="args" class="panel-body collapse in">
				<p>Files downloaded from here need to be imported into Cytoscape for visualization. For more details - <a href="#">Visit this page</a> </p>
                <form role="form">
                  <div class="form-group">
					<p>Barupal, Dinesh K., Pradeep K. Haldiya, Gert Wohlgemuth, Tobias Kind, Shanker L. Kothari, Kent E. Pinkerton, and Oliver Fiehn. "MetaMapp: mapping and visualizing metabolomic data by integrating information from biochemical pathways and chemical and mass spectral similarity." BMC bioinformatics 13, no. 1 (2012): 99.</p>
					<p>Hartman, A. L., Lough, D. M., Barupal, D. K., Fiehn, O., Fishbein, T., Zasloff, M., & Eisen, J. A. (2009). Human gut microbiome adopts an alternative state following small bowel transplantation. Proceedings of the National Academy of Sciences, 106(40), 17187-17192.</p>
                  </div>

                  <!-- /.row -->

                </form>
              </div>
            </div>
          </div>
        </div>


      <!-- notify box -->
        <div id="notifyBox" class="modal fade" tabindex="-1" role="dialog" data-keyboard="false" data-backdrop="static">
          <div class="modal-dialog"><div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <h4>Computing ...</h4>
              <span id="notifyTxt"></span>
            </div>
            <div class="modal-body"><div style="height:200px">
              <span id="loading_spinner" style="position: absolute;display: block;top: 50%;left: 50%;"></span>
            </div></div>
          </div></div>
        </div>
        <!-- /.notify box -->



      </div>
      <!-- /.container-fluid -->
    </div>
    <!-- /#page-wrapper -->
  </div>
  <!-- /#wrapper -->
</body>
</html>
