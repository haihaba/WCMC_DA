input = "batch	A	A	A	A	A	A	A	A	A	A	B	B	B	B	B	B	B	B	B	B
QC	TRUE	FALSE	FALSE	TRUE	FALSE	TRUE	FALSE	TRUE	FALSE	TRUE	TRUE	FALSE	FALSE	TRUE	FALSE	TRUE	FALSE	TRUE	FALSE	TRUE
label	sample1	sample2	sample3	sample4	sample5	sample6	sample7	sample8	sample9	sample10	sample11	sample12	sample13	sample14	sample15	sample16	sample17	sample18	sample19	sample20
compound 1	0.563803294	0.299601962	0.248294456	0.233070343	0.74236419	0.920282816	0.932172186	0.484063911	0.777657105	0.481969513	0.124157358	0.569470409	0.174615101	0.137400112	0.807400553	0.537645361	0.705558638	0.600072205	0.125970009	0.372083672
compound 2	0.230761134	0.758767482	0.264245619	0.782114067	0.038473658	0.691578976	0.752506471	0.505064608	0.808510116	0.591750547	0.295365007	0.233129942	0.536013395	0.753519861	0.464678864	0.764855412	0.880155028	0.200698167	0.658145868	0.21818996
compound 3	0.666519678	0.779507965	0.250614972	0.767125416	0.879445181	0.803560656	0.183447289	0.680703699	0.685311219	0.164554804	0.810091553	0.603404407	0.670606781	0.428486509	0.301628454	0.186993121	0.266200428	0.253438733	0.642877385	0.628055317
compound 4	0.516043852	0.043577674	0.785949563	0.304542368	0.037182796	0.016457839	0.249663356	0.159176436	0.970155309	0.652153767	0.612800338	0.207604415	0.653840185	0.560469478	0.406231417	0.584379568	0.612071273	0.744348001	0.713154298	0.006270303
compound 5	0.699814933	0.407248972	0.964932767	0.757393322	0.81558582	0.013536402	0.076289649	0.493479626	0.372895096	0.047422136	0.143161654	0.65754482	0.51756457	0.55293973	0.936493918	0.777802371	0.476813097	0.33545782	0.366081138	0.101967574
compound 6	0.008985606	0.873348837	0.869899708	0.559820709	0.053869343	0.988315505	0.187286498	0.490197459	0.977972664	0.278700544	0.009555966	0.245545986	0.751116454	0.454329032	0.204266607	0.492287626	0.358445043	0.23233619	0.658748715	0.250145962
compound 7	0.176013895	0.816377924	0.840136614	0.622885804	0.072913722	0.84097543	0.782001573	0.733267205	0.733457623	0.274554247	0.157465706	0.401909826	0.918218535	0.825546351	0.801025776	0.878784491	0.423330364	0.920439481	0.701232884	0.688023688
compound 8	0.403118572	0.693999203	0.486853017	0.179176339	0.448565379	0.820310481	0.346177735	0.52207931	0.986801022	0.473767817	0.948423044	0.083068282	0.941529795	0.011454391	0.569452485	0.2565831	0.771754511	0.220283652	0.389622471	0.642709655
compound 9	0.078300767	0.284515574	0.568002549	0.243626918	0.769668511	0.039392705	0.809860315	0.796024021	0.312615978	0.072056737	0.564160474	0.694822103	0.544802736	0.304671641	0.946068422	0.900135734	0.040933698	0.303558353	0.616587732	0.481514272
compound 10	0.547028107	0.054728648	0.867161618	0.81688089	0.146129155	0.420063745	0.466006465	0.937459987	0.065659298	0.356917804	0.848844316	0.2435501	0.094259052	0.41116012	0.658443345	0.524812665	0.348358263	0.911104959	0.983794696	0.923634943
compound 11	0.250543364	0.20057665	0.675485546	0.776071533	0.509394858	0.625363268	0.514590191	0.53320271	0.125678463	0.92210783	0.926984343	0.573799535	0.988108963	0.016887671	0.296019094	0.583655035	0.78615203	0.036377801	0.569117067	0.282582282
compound 12	0.66162143	0.279200698	0.735362534	0.002179745	0.081321537	0.085441616	0.012561276	0.23660901	0.670279231	0.856782585	0.170957038	0.956587667	0.343355223	0.336113583	0.553699677	0.65101006	0.25805278	0.897960696	0.736034441	0.269483991
compound 13	0.753226354	0.785116587	0.07644987	0.136978788	0.746551584	0.616026446	0.184554538	0.889050212	0.491711532	0.621596136	0.611005373	0.175624961	0.067852751	0.96530709	0.486890693	0.858705185	0.046139204	0.63540875	0.736209498	0.245314749
compound 14	0.470048073	0.521004908	0.253019423	0.030516813	0.97265175	0.552193698	0.764063995	0.925748852	0.4694391	0.18738214	0.055213337	0.088821965	0.125510842	0.695348629	0.317103077	0.160378394	0.662261147	0.859208783	0.578966728	0.388423708
compound 15	0.495416986	0.946037517	0.947363537	0.497633822	0.407968237	0.530530082	0.727629577	0.786507576	0.759201954	0.979583226	0.890591485	0.946971645	0.149516548	0.753741066	0.231422905	0.140566519	0.916308101	0.338598871	0.205740183	0.939135973
compound 16	0.98484594	0.277320895	0.108458773	0.754260346	0.760990466	0.975621106	0.120569542	0.655902083	0.795593902	0.929250617	0.776151231	0.037318392	0.822352169	0.460072654	0.455831076	0.997166002	0.011930126	0.969400448	0.108042767	0.325787263
compound 17	0.594512845	0.937493085	0.133910835	0.948346798	0.954074187	0.108464292	0.411008485	0.697175455	0.284073483	0.889797794	0.024611158	0.518304402	0.419715852	0.513703778	0.159568048	0.154700957	0.362359983	0.032625313	0.464233776	0.687742303
compound 18	0.547397866	0.846767419	0.240886348	0.382793142	0.372676273	0.722431806	0.668706021	0.316598128	0.25463985	0.397962254	0.948044475	0.258430944	0.509727458	0.769993297	0.231685164	0.805808929	0.29286453	0.142690549	0.551643542	0.033825543
compound 19	0.700099054	0.563913297	0.482430725	0.991726897	0.323107168	0.827295876	0.395863849	0.697422932	0.693466497	0.088363412	0.798846134	0.778123346	0.261800855	0.900680033	0.545804559	0.27579857	0.545986448	0.080381891	0.737538437	0.51906835
compound 20	0.326429726	0.317353502	0.211853364	0.460179602	0.560440072	0.263845847	0.468529793	0.469073442	0.421921827	0.727353841	0.158412438	0.750990438	0.025843783	0.954647291	0.789277978	0.198508901	0.631732815	0.465109628	0.997800721	0.976521456
"
library(pacman)
pacman::p_load(data.table)
input <- gsub("\r","",input)
cfile <- strsplit(input,"\n")[[1]]
df1 <- as.data.frame(do.call(rbind,lapply(cfile,function(x){strsplit(x,"\t")[[1]]})),stringsAsFactors = F)
colnames(df1) = as.matrix(df1[1,])[1,]
df1 = df1[-1,]
data = sapply(df1[,-1], as.numeric)
View(data)
library(pacman)
pacman::p_load(data.table)
input <- gsub("\r","",input)
cfile <- strsplit(input,"\n")[[1]]
df1 <- as.data.frame(do.call(rbind,lapply(cfile,function(x){strsplit(x,"\t")[[1]]})),stringsAsFactors = F)
colnames(df1) = as.matrix(df1[1,])[1,]
View(df1)
library(pacman)
pacman::p_load(data.table)
input <- gsub("\r","",input)
cfile <- strsplit(input,"\n")[[1]]
df1 <- as.data.frame(do.call(rbind,lapply(cfile,function(x){strsplit(x,"\t")[[1]]})),stringsAsFactors = F)
View(df1)
p = df1[1:3,]
View(p)
p = t(p)
View(p)
colnames(p) = p[1,]
p = p[-1,]
View(p)
View(df1)
f=df1[4:nrow(df1),1]
View(f)
df1[4:nrow(df1),1]
f=data.frame(df1[4:nrow(df1),1])
f=data.frame(df1[4:nrow(df1),1])
colnames(f) = 'compound label'
View(f)
e = [4:nrow(df1),2:ncol(df1)]
e = df1[4:nrow(df1),2:ncol(df1)]
View(e)
class(e)
e = as.matrix(e)
e_batch_norm = matrix(,nrow=nrow(e),ncol=ncol(e))
names(p)
library(pacman)
pacman::p_load(data.table)
input <- gsub("\r","",input)
cfile <- strsplit(input,"\n")[[1]]
df1 <- as.data.frame(do.call(rbind,lapply(cfile,function(x){strsplit(x,"\t")[[1]]})),stringsAsFactors = F)
p = df1[1:3,]
p = t(p)
colnames(p) = p[1,]
p = p[-1,]
names(p)
View(p)
class(p)
p = data.frame(p)
p
p$QC
library(pacman)
pacman::p_load(data.table)
input <- gsub("\r","",input)
cfile <- strsplit(input,"\n")[[1]]
df1 <- as.data.frame(do.call(rbind,lapply(cfile,function(x){strsplit(x,"\t")[[1]]})),stringsAsFactors = F)
p = df1[1:3,]
p = t(p)
colnames(p) = p[1,]
p = p[-1,]
p = data.frame(p,stringsAsFactors = F)
f=data.frame(df1[4:nrow(df1),1])
colnames(f) = 'compound label'
e = df1[4:nrow(df1),2:ncol(df1)]
e = as.matrix(e)
i=1
as.numeric(e[i,p$QC])
i
p$QC
p$QC = as.logical(p$QC)
as.numeric(e[i,p$QC])
batch[i,p$QC]
batch = p$batch
batch
p$batch[p$QC]
means = by(as.numeric(e[i,p$QC]),p$batch[p$QC], mean, na.rm=T)
mean_means = mean(means)
e_batch_norm[i,] = as.numeric(e[i,])-(rep(means,times=table(batch[i,]))-mean_means)
e_batch_norm[i,] = as.numeric(e[i,])-(rep(means,times=table(p$batch))-mean_means)
as.numeric(e[i,])-(rep(means,times=table(p$batch))-mean_means)
e_batch_norm = matrix(,nrow=nrow(e),ncol=ncol(e))
for(i in 1:nrow(f)){
means = by(as.numeric(e[i,p$QC]),p$batch[p$QC], mean, na.rm=T)
mean_means = mean(means)
e_batch_norm[i,] = as.numeric(e[i,])-(rep(means,times=table(p$batch))-mean_means)
}
rownames(e_batch_norm) = rownames(e)
colnames(e_batch_norm) = colnames(e)
library(WCMC.Normalization.Batch)
library(WCMC.Normalization.Batch)
library(opencpu);
opencpu$browse("library/WCMC.Normalization/www")
library(WCMC.Normalization.Batch)
library(opencpu);
opencpu$browse("library/WCMC.Normalization.Batch/www")
library(WCMC.Normalization.Batch)
library(opencpu);
opencpu$browse("library/WCMC.Normalization.Batch/www")
library(WCMC.Normalization.Batch)
library(opencpu);
opencpu$browse("library/WCMC.Normalization.Batch/www")
library(WCMC.Normalization.Batch)
library(opencpu);
opencpu$browse("library/WCMC.Normalization.Batch/www")
library(WCMC.Normalization.Batch)
library(opencpu);
opencpu$browse("library/WCMC.Normalization.Batch/www")
library(WCMC.Normalization.Batch)
library(opencpu);
opencpu$browse("library/WCMC.Normalization.Batch/www")
e_batch_norm
colnames(e_batch_norm) = p$label
rownames(e_batch_norm) = f$`compound label`
library(WCMC.Normalization.Batch)
rownames(e_batch_norm) = f$`compound label`
library(opencpu);
opencpu$browse("library/WCMC.Normalization.Batch/www")
e_batch_norm = cbind(data.table(compounds=f$`compound label`),e_batch_norm)
e_batch_norm
library(WCMC.Normalization.Batch)
library(opencpu);
opencpu$browse("library/WCMC.Normalization.Batch/www")
library(WCMC.Normalization.Batch)
library(WCMC.Normalization.Batch)
library(opencpu);
opencpu$browse("library/WCMC.Normalization.Batch/www")
library(WCMC.Normalization.Batch)
e_batch_norm
library(WCMC.Normalization.Batch)
library(WCMC.Normalization.Batch)
purl <- "http://wcmc-da.fiehnlab.ucdavis.edu/ocpu/library/utils/R/install.packages"
library(RCurl)
library(jsonlite)
getURL(purl,customrequest='POST',httpheader=c('Content-Type'='application/json'),
postfields=toJSON(list(pkgs="https://github.com/slfan2013/WCMC_DA/raw/master/WCMC.Normalization.Batch_0.1.0.tar.gz")))
input = "batch	A	A	A	A	A	A	A	A	A	A	B	B	B	B	B	B	B	B	B	B
QC	TRUE	FALSE	FALSE	TRUE	FALSE	TRUE	FALSE	TRUE	FALSE	TRUE	TRUE	FALSE	FALSE	TRUE	FALSE	TRUE	FALSE	TRUE	FALSE	TRUE
label	sample1	sample2	sample3	sample4	sample5	sample6	sample7	sample8	sample9	sample10	sample11	sample12	sample13	sample14	sample15	sample16	sample17	sample18	sample19	sample20
compound 1	0.740177985	0.546815729	0.475964472	0.367890065	0.291455553	0.709442615	0.918054924	0.449962304	0.886077535	0.714647074	0.324868645	0.981058912	0.34237232	0.13770531	0.280872715	0.492149143	0.01010557	0.440520773	0.460848896	0.922243659
compound 2	0.093388904	0.501680833	0.454134535	0.125285724	0.732146838	0.341767071	0.409119782	0.332498872	0.724509204	0.199778011	0.093296577	0.84064341	0.507404584	0.168347542	0.044663529	0.311703357	0.106078181	0.164253013	0.074905836	0.141986281
compound 3	0.165015038	0.886990165	0.993355724	0.738600516	0.32047271	0.691845466	0.277564634	0.353952124	0.349471362	0.08972861	0.958685397	0.856721603	0.460327941	0.667009708	0.910219762	0.841258816	0.845534963	0.598260131	0.313763825	0.806962401
compound 4	0.956533564	0.615204575	0.978134805	0.615322871	0.873433587	0.982462784	0.595439217	0.77274316	0.410060328	0.903041772	0.077475276	0.953705364	0.488424107	0.690876714	0.910894226	0.519541093	0.83671336	0.612572407	0.056127546	0.177841694
compound 5	0.267953327	0.237113047	0.384472495	0.532910529	0.343029576	0.396667402	0.211043941	0.81953257	0.119829467	0.414572434	0.323362846	0.463559752	0.042151984	0.763618526	0.662675146	0.980752887	0.874518764	0.730431551	0.394272189	0.930886314
compound 6	0.381946952	0.414513135	0.193623199	0.01781625	0.282770256	0.881102034	0.330194896	0.356073653	0.793404717	0.775979478	0.869632726	0.592913184	0.053241423	0.088303049	0.87350568	0.354382568	0.663597041	0.771207659	0.445956455	0.413360624
compound 7	0.423121312	0.883726233	0.765473408	0.374210266	0.919998878	0.453026097	0.805233269	0.223217193	0.963031111	0.90299723	0.849765672	0.131292976	0.303586321	0.828829041	0.178973672	0.07262284	0.055014795	0.206416317	0.399226104	0.795099034
compound 8	0.485338079	0.069690706	0.992389289	0.255533959	0.17939934	0.069089869	0.271665596	0.467657432	0.620895716	0.407975751	0.988628352	0.378516051	0.643509149	0.040340927	0.523403509	0.263107422	0.888268472	0.451391823	0.040147163	0.496909612
compound 9	0.344572974	0.079875871	0.849009143	0.306890434	0.158055933	0.031744654	0.931809456	0.988138376	0.58319333	0.981468062	0.12493396	0.968747885	0.89635392	0.595369999	0.081343146	0.245386859	0.715246149	0.198772739	0.592102408	0.126583544
compound 10	0.857067478	0.224200998	0.933920494	0.862656441	0.463594975	0.306071335	0.770065005	0.189232857	0.142170781	0.854378515	0.687466907	0.743224247	0.178820356	0.226122934	0.634803573	0.479787902	0.337959663	0.681089746	0.242551542	0.937097397
compound 11	0.119640397	0.861748105	0.307139603	0.865410929	0.876704082	0.555273096	0.455033786	0.753121627	0.262935416	0.238221294	0.254601235	0.013841683	0.604200705	0.040438407	0.570814274	0.356407596	0.148107706	0.906018032	0.144609471	0.647955805
compound 12	0.933048596	0.942016897	0.657687897	0.64269165	0.703745128	0.157665016	0.259614288	0.285219334	0.314502485	0.937505962	0.660467235	0.246909415	0.850895658	0.494919198	0.368769957	0.574119005	0.363459607	0.117454123	0.140838946	0.999481267
compound 13	0.986211711	0.347243182	0.805537471	0.740582256	0.29599143	0.054726636	0.27604709	0.690747977	0.62968036	0.559475453	0.685246282	0.87271747	0.584907207	0.414156856	0.382503155	0.340449632	0.851341184	0.898042164	0.100855315	0.050875126
compound 14	0.561433372	0.714168978	0.540550801	0.041972511	0.513598396	0.693312062	0.84671411	0.64358975	0.836384692	0.279914918	0.855101144	0.232056587	0.690883714	0.745237733	0.549641066	0.857182511	0.015200825	0.120827085	0.457610322	0.70530488
compound 15	0.262783616	0.311351409	0.281746333	0.346551622	0.040459655	0.437301386	0.688646553	0.352120182	0.635456507	0.914905189	0.602114177	0.901260526	0.368045125	0.992562833	0.58209909	0.131994873	0.861341235	0.548409684	0.46033338	0.274167058
compound 16	0.13343438	0.93093736	0.859504858	0.670650608	0.156769203	0.565233105	0.054572323	0.289045326	0.337708657	0.130988396	0.94751698	0.379616032	0.824877622	0.902200139	0.958682674	0.436432685	0.812087042	0.790269006	0.4638475	0.273397456
compound 17	0.186560045	0.366236634	0.054098422	0.383276521	0.542079747	0.916593431	0.447949205	0.129545299	0.136975097	0.842036568	0.139166804	0.278803727	0.201350826	0.099515053	0.87219056	0.612611496	0.939929808	0.361770731	0.968432868	0.64387888
compound 18	0.600184688	0.621515246	0.388947628	0.553419861	0.313053695	0.960513309	0.012429191	0.764532727	0.735990376	0.959088596	0.754648038	0.102150908	0.928929323	0.45871674	0.07435746	0.099474268	0.787895258	0.399725762	0.77019595	0.689548169
compound 19	0.851837128	0.221385851	0.491347015	0.240973127	0.522896426	0.198570937	0.854051805	0.411145875	0.972393717	0.472875637	0.694746313	0.374977516	0.589561583	0.601896852	0.752361263	0.364574612	0.393431581	0.159343749	0.162075858	0.782503971
compound 20	0.801186776	0.279148614	0.369077343	0.917114121	0.911280724	0.736479105	0.120052112	0.016999832	0.363235592	0.266846149	0.382253251	0.895305722	0.904400711	0.65024827	0.644474598	0.906803587	0.478373022	0.404977737	0.317810515	0.012783028
"
library(pacman)
pacman::p_load(data.table)
input <- gsub("\r","",input)
cfile <- strsplit(input,"\n")[[1]]
df1 <- as.data.frame(do.call(rbind,lapply(cfile,function(x){strsplit(x,"\t")[[1]]})),stringsAsFactors = F)
p = df1[1:3,]
p = t(p)
colnames(p) = p[1,]
p = p[-1,]
p = data.frame(p,stringsAsFactors = F)
f=data.frame(df1[4:nrow(df1),1])
colnames(f) = 'compound label'
e = df1[4:nrow(df1),2:ncol(df1)]
e = as.matrix(e)
p$QC = as.logical(p$QC)
e_batch_norm = matrix(,nrow=nrow(e),ncol=ncol(e))
for(i in 1:nrow(f)){
means = by(as.numeric(e[i,p$QC]),p$batch[p$QC], mean, na.rm=T)
mean_means = mean(means)
e_batch_norm[i,] = as.numeric(e[i,])-(rep(means,times=table(p$batch))-mean_means)
}
e1 = WCMC.Fansly::toSameScale(e,e_batch_norm)
e
e_batch_norm
e = apply(e,2,as.numeric)
e1 = WCMC.Fansly::toSameScale(e,e_batch_norm)
colnames(e_batch_norm) = p$label
e_batch_norm = cbind(data.table(compounds=f$`compound label`),e_batch_norm)
library(WCMC.Normalization.Batch)
getURL(purl,customrequest='POST',httpheader=c('Content-Type'='application/json'),
postfields=toJSON(list(pkgs="https://github.com/slfan2013/WCMC_DA/raw/master/WCMC.Normalization.Batch_0.1.0.tar.gz")))
getURL(purl,customrequest='POST',httpheader=c('Content-Type'='application/json'),
postfields=toJSON(list(pkgs="https://github.com/slfan2013/WCMC_DA/raw/master/WCMC.Normalization.Batch_0.1.0.tar.gz")))
library(opencpu);
opencpu$browse("library/WCMC.Normalization.Batch/www")
library(WCMC.Normalization.Batch)
