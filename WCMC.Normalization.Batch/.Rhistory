input = "batch	A	A	A	A	A	A	A	A	A	A	B	B	B	B	B	B	B	B	B	B
QC	TRUE	FALSE	FALSE	TRUE	FALSE	TRUE	FALSE	TRUE	FALSE	TRUE	TRUE	FALSE	FALSE	TRUE	FALSE	TRUE	FALSE	TRUE	FALSE	TRUE
label	sample1	sample2	sample3	sample4	sample5	sample6	sample7	sample8	sample9	sample10	sample11	sample12	sample13	sample14	sample15	sample16	sample17	sample18	sample19	sample20
compound 1	0.563803294	0.299601962	0.248294456	0.233070343	0.74236419	0.920282816	0.932172186	0.484063911	0.777657105	0.481969513	0.124157358	0.569470409	0.174615101	0.137400112	0.807400553	0.537645361	0.705558638	0.600072205	0.125970009	0.372083672
compound 2	0.230761134	0.758767482	0.264245619	0.782114067	0.038473658	0.691578976	0.752506471	0.505064608	0.808510116	0.591750547	0.295365007	0.233129942	0.536013395	0.753519861	0.464678864	0.764855412	0.880155028	0.200698167	0.658145868	0.21818996
compound 3	0.666519678	0.779507965	0.250614972	0.767125416	0.879445181	0.803560656	0.183447289	0.680703699	0.685311219	0.164554804	0.810091553	0.603404407	0.670606781	0.428486509	0.301628454	0.186993121	0.266200428	0.253438733	0.642877385	0.628055317
compound 4	0.516043852	0.043577674	0.785949563	0.304542368	0.037182796	0.016457839	0.249663356	0.159176436	0.970155309	0.652153767	0.612800338	0.207604415	0.653840185	0.560469478	0.406231417	0.584379568	0.612071273	0.744348001	0.713154298	0.006270303
compound 5	0.699814933	0.407248972	0.964932767	0.757393322	0.81558582	0.013536402	0.076289649	0.493479626	0.372895096	0.047422136	0.143161654	0.65754482	0.51756457	0.55293973	0.936493918	0.777802371	0.476813097	0.33545782	0.366081138	0.101967574
compound 6	0.008985606	0.873348837	0.869899708	0.559820709	0.053869343	0.988315505	0.187286498	0.490197459	0.977972664	0.278700544	0.009555966	0.245545986	0.751116454	0.454329032	0.204266607	0.492287626	0.358445043	0.23233619	0.658748715	0.250145962
compound 7	0.176013895	0.816377924	0.840136614	0.622885804	0.072913722	0.84097543	0.782001573	0.733267205	0.733457623	0.274554247	0.157465706	0.401909826	0.918218535	0.825546351	0.801025776	0.878784491	0.423330364	0.920439481	0.701232884	0.688023688
compound 8	0.403118572	0.693999203	0.486853017	0.179176339	0.448565379	0.820310481	0.346177735	0.52207931	0.986801022	0.473767817	0.948423044	0.083068282	0.941529795	0.011454391	0.569452485	0.2565831	0.771754511	0.220283652	0.389622471	0.642709655
compound 9	0.078300767	0.284515574	0.568002549	0.243626918	0.769668511	0.039392705	0.809860315	0.796024021	0.312615978	0.072056737	0.564160474	0.694822103	0.544802736	0.304671641	0.946068422	0.900135734	0.040933698	0.303558353	0.616587732	0.481514272
compound 10	0.547028107	0.054728648	0.867161618	0.81688089	0.146129155	0.420063745	0.466006465	0.937459987	0.065659298	0.356917804	0.848844316	0.2435501	0.094259052	0.41116012	0.658443345	0.524812665	0.348358263	0.911104959	0.983794696	0.923634943
compound 11	0.250543364	0.20057665	0.675485546	0.776071533	0.509394858	0.625363268	0.514590191	0.53320271	0.125678463	0.92210783	0.926984343	0.573799535	0.988108963	0.016887671	0.296019094	0.583655035	0.78615203	0.036377801	0.569117067	0.282582282
compound 12	0.66162143	0.279200698	0.735362534	0.002179745	0.081321537	0.085441616	0.012561276	0.23660901	0.670279231	0.856782585	0.170957038	0.956587667	0.343355223	0.336113583	0.553699677	0.65101006	0.25805278	0.897960696	0.736034441	0.269483991
compound 13	0.753226354	0.785116587	0.07644987	0.136978788	0.746551584	0.616026446	0.184554538	0.889050212	0.491711532	0.621596136	0.611005373	0.175624961	0.067852751	0.96530709	0.486890693	0.858705185	0.046139204	0.63540875	0.736209498	0.245314749
compound 14	0.470048073	0.521004908	0.253019423	0.030516813	0.97265175	0.552193698	0.764063995	0.925748852	0.4694391	0.18738214	0.055213337	0.088821965	0.125510842	0.695348629	0.317103077	0.160378394	0.662261147	0.859208783	0.578966728	0.388423708
compound 15	0.495416986	0.946037517	0.947363537	0.497633822	0.407968237	0.530530082	0.727629577	0.786507576	0.759201954	0.979583226	0.890591485	0.946971645	0.149516548	0.753741066	0.231422905	0.140566519	0.916308101	0.338598871	0.205740183	0.939135973
compound 16	0.98484594	0.277320895	0.108458773	0.754260346	0.760990466	0.975621106	0.120569542	0.655902083	0.795593902	0.929250617	0.776151231	0.037318392	0.822352169	0.460072654	0.455831076	0.997166002	0.011930126	0.969400448	0.108042767	0.325787263
compound 17	0.594512845	0.937493085	0.133910835	0.948346798	0.954074187	0.108464292	0.411008485	0.697175455	0.284073483	0.889797794	0.024611158	0.518304402	0.419715852	0.513703778	0.159568048	0.154700957	0.362359983	0.032625313	0.464233776	0.687742303
compound 18	0.547397866	0.846767419	0.240886348	0.382793142	0.372676273	0.722431806	0.668706021	0.316598128	0.25463985	0.397962254	0.948044475	0.258430944	0.509727458	0.769993297	0.231685164	0.805808929	0.29286453	0.142690549	0.551643542	0.033825543
compound 19	0.700099054	0.563913297	0.482430725	0.991726897	0.323107168	0.827295876	0.395863849	0.697422932	0.693466497	0.088363412	0.798846134	0.778123346	0.261800855	0.900680033	0.545804559	0.27579857	0.545986448	0.080381891	0.737538437	0.51906835
compound 20	0.326429726	0.317353502	0.211853364	0.460179602	0.560440072	0.263845847	0.468529793	0.469073442	0.421921827	0.727353841	0.158412438	0.750990438	0.025843783	0.954647291	0.789277978	0.198508901	0.631732815	0.465109628	0.997800721	0.976521456
"
library(pacman)
pacman::p_load(data.table)
input <- gsub("\r","",input)
cfile <- strsplit(input,"\n")[[1]]
df1 <- as.data.frame(do.call(rbind,lapply(cfile,function(x){strsplit(x,"\t")[[1]]})),stringsAsFactors = F)
colnames(df1) = as.matrix(df1[1,])[1,]
df1 = df1[-1,]
data = sapply(df1[,-1], as.numeric)
View(data)
library(pacman)
pacman::p_load(data.table)
input <- gsub("\r","",input)
cfile <- strsplit(input,"\n")[[1]]
df1 <- as.data.frame(do.call(rbind,lapply(cfile,function(x){strsplit(x,"\t")[[1]]})),stringsAsFactors = F)
colnames(df1) = as.matrix(df1[1,])[1,]
View(df1)
library(pacman)
pacman::p_load(data.table)
input <- gsub("\r","",input)
cfile <- strsplit(input,"\n")[[1]]
df1 <- as.data.frame(do.call(rbind,lapply(cfile,function(x){strsplit(x,"\t")[[1]]})),stringsAsFactors = F)
View(df1)
p = df1[1:3,]
View(p)
p = t(p)
View(p)
colnames(p) = p[1,]
p = p[-1,]
View(p)
View(df1)
f=df1[4:nrow(df1),1]
View(f)
df1[4:nrow(df1),1]
f=data.frame(df1[4:nrow(df1),1])
f=data.frame(df1[4:nrow(df1),1])
colnames(f) = 'compound label'
View(f)
e = [4:nrow(df1),2:ncol(df1)]
e = df1[4:nrow(df1),2:ncol(df1)]
View(e)
class(e)
e = as.matrix(e)
e_batch_norm = matrix(,nrow=nrow(e),ncol=ncol(e))
names(p)
library(pacman)
pacman::p_load(data.table)
input <- gsub("\r","",input)
cfile <- strsplit(input,"\n")[[1]]
df1 <- as.data.frame(do.call(rbind,lapply(cfile,function(x){strsplit(x,"\t")[[1]]})),stringsAsFactors = F)
p = df1[1:3,]
p = t(p)
colnames(p) = p[1,]
p = p[-1,]
names(p)
View(p)
class(p)
p = data.frame(p)
p
p$QC
library(pacman)
pacman::p_load(data.table)
input <- gsub("\r","",input)
cfile <- strsplit(input,"\n")[[1]]
df1 <- as.data.frame(do.call(rbind,lapply(cfile,function(x){strsplit(x,"\t")[[1]]})),stringsAsFactors = F)
p = df1[1:3,]
p = t(p)
colnames(p) = p[1,]
p = p[-1,]
p = data.frame(p,stringsAsFactors = F)
f=data.frame(df1[4:nrow(df1),1])
colnames(f) = 'compound label'
e = df1[4:nrow(df1),2:ncol(df1)]
e = as.matrix(e)
i=1
as.numeric(e[i,p$QC])
i
p$QC
p$QC = as.logical(p$QC)
as.numeric(e[i,p$QC])
batch[i,p$QC]
batch = p$batch
batch
p$batch[p$QC]
means = by(as.numeric(e[i,p$QC]),p$batch[p$QC], mean, na.rm=T)
mean_means = mean(means)
e_batch_norm[i,] = as.numeric(e[i,])-(rep(means,times=table(batch[i,]))-mean_means)
e_batch_norm[i,] = as.numeric(e[i,])-(rep(means,times=table(p$batch))-mean_means)
as.numeric(e[i,])-(rep(means,times=table(p$batch))-mean_means)
e_batch_norm = matrix(,nrow=nrow(e),ncol=ncol(e))
for(i in 1:nrow(f)){
means = by(as.numeric(e[i,p$QC]),p$batch[p$QC], mean, na.rm=T)
mean_means = mean(means)
e_batch_norm[i,] = as.numeric(e[i,])-(rep(means,times=table(p$batch))-mean_means)
}
rownames(e_batch_norm) = rownames(e)
colnames(e_batch_norm) = colnames(e)
library(WCMC.Normalization.Batch)
library(WCMC.Normalization.Batch)
library(opencpu);
opencpu$browse("library/WCMC.Normalization/www")
library(WCMC.Normalization.Batch)
library(opencpu);
opencpu$browse("library/WCMC.Normalization.Batch/www")
library(WCMC.Normalization.Batch)
library(opencpu);
opencpu$browse("library/WCMC.Normalization.Batch/www")
library(WCMC.Normalization.Batch)
library(opencpu);
opencpu$browse("library/WCMC.Normalization.Batch/www")
library(WCMC.Normalization.Batch)
library(opencpu);
opencpu$browse("library/WCMC.Normalization.Batch/www")
library(WCMC.Normalization.Batch)
library(opencpu);
opencpu$browse("library/WCMC.Normalization.Batch/www")
library(WCMC.Normalization.Batch)
library(opencpu);
opencpu$browse("library/WCMC.Normalization.Batch/www")
e_batch_norm
colnames(e_batch_norm) = p$label
rownames(e_batch_norm) = f$`compound label`
library(WCMC.Normalization.Batch)
rownames(e_batch_norm) = f$`compound label`
library(opencpu);
opencpu$browse("library/WCMC.Normalization.Batch/www")
e_batch_norm = cbind(data.table(compounds=f$`compound label`),e_batch_norm)
e_batch_norm
library(WCMC.Normalization.Batch)
library(opencpu);
opencpu$browse("library/WCMC.Normalization.Batch/www")
library(WCMC.Normalization.Batch)
library(WCMC.Normalization.Batch)
library(opencpu);
opencpu$browse("library/WCMC.Normalization.Batch/www")
library(WCMC.Normalization.Batch)
